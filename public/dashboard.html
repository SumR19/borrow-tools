<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î - ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Dashboard Header */
        .dashboard-header {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 165, 0, 0.1) 100%);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .dashboard-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .dashboard-title {
            position: relative;
            z-index: 2;
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .dashboard-subtitle {
            position: relative;
            z-index: 2;
            color: #E2E8F0;
            font-size: 1.2rem;
            opacity: 0.8;
        }

        /* Enhanced Stat Cards */
        .stat-card {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1) 0%, rgba(255, 165, 0, 0.05) 100%);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.2) 0%, rgba(255, 165, 0, 0.1) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: #FFD700;
            box-shadow: 0 20px 40px rgba(255, 215, 0, 0.3);
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-icon {
            font-size: 3.5rem;
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 8px rgba(255, 215, 0, 0.3));
            position: relative;
            z-index: 2;
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 800;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
            position: relative;
            z-index: 2;
        }

        .stat-label {
            color: #E2E8F0;
            font-size: 1.1rem;
            font-weight: 600;
            opacity: 0.9;
            position: relative;
            z-index: 2;
        }

        /* Enhanced Charts */
        .chart-container {
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            position: relative;
            overflow: hidden;
        }

        .chart-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #FFD700 0%, #FFA500 50%, #FFD700 100%);
        }

        .chart-title {
            color: #2d3748;
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chart-title .icon {
            color: #FFD700;
            font-size: 1.5rem;
        }

        /* === ACTIVITY SECTION STYLES === */
        .activity-section {
            margin-top: 2rem;
        }

        .premium-activity-card {
            border: 2px solid rgba(255, 215, 0, 0.2);
            overflow: hidden;
        }

        .activity-header {
            background: rgba(255, 215, 0, 0.1);
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-title {
            margin: 0;
            color: #FFD700;
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .activity-icon {
            font-size: 1.5rem;
            filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5));
        }

        .refresh-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #0A192F;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .refresh-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        /* Premium Table */
        .activity-table-wrapper {
            padding: 1.5rem;
        }

        .premium-table {
            width: 100%;
            border-collapse: collapse;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            overflow: hidden;
        }

        .premium-table thead tr {
            background: rgba(255, 215, 0, 0.1);
        }

        .premium-table th {
            padding: 1rem;
            color: #FFD700;
            font-weight: 600;
            text-align: left;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }

        .premium-table td {
            padding: 1rem;
            color: #E2E8F0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .premium-table tr:hover {
            background: rgba(255, 215, 0, 0.05);
        }

        .table-icon {
            margin-right: 0.5rem;
            filter: drop-shadow(0 0 3px rgba(255, 215, 0, 0.3));
        }

        .loading-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 2rem;
            text-align: center;
        }

        .loading-spinner {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ===== SINGLE PAGE LAYOUT ===== */
        .dashboard-main {
            height: calc(100vh - 120px);
            overflow: hidden;
        }

        .single-page-container {
            height: 100%;
            max-width: 1600px;
            padding: 0 1rem;
        }

        /* Compact Navigation */
        .compact-nav {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .nav-link-compact {
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 25px;
            color: #FFD700;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-link-compact:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: rgba(255, 215, 0, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }

        .refresh-btn-compact {
            padding: 0.75rem 1.25rem;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #0A192F;
            border: none;
            border-radius: 25px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .refresh-btn-compact:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }

        /* Single Page Grid - 3 Column Layout */
        .single-page-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1.5rem;
            height: calc(100% - 80px);
        }

        /* Left Column - Line Chart */
        .left-column {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Middle Column - Stats */
        .middle-column {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Right Column - Doughnut Chart + Activity */
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Compact Stats - 2x2 Grid */
        .compact-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .mini-stat-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .mini-stat-card:hover {
            transform: translateY(-3px);
            border-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.2);
        }

        .mini-stat-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            filter: drop-shadow(0 0 8px rgba(255, 215, 0, 0.3));
        }

        .mini-stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #FFD700;
            margin-bottom: 0.25rem;
        }

        .mini-stat-label {
            color: #94A3B8;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* Compact Chart */
        .compact-chart {
            flex: 1;
        }

        .compact-chart-container {
            height: 100%;
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
        }

        .chart-header-compact {
            background: rgba(255, 215, 0, 0.1);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .chart-title-compact {
            margin: 0;
            color: #FFD700;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chart-content-compact {
            flex: 1;
            padding: 1rem;
            position: relative;
        }

        /* Right Column */
        .right-column {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Mini Chart */
        .mini-chart-container {
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            backdrop-filter: blur(15px);
            height: 250px;
            display: flex;
            flex-direction: column;
        }

        .full-height-chart {
            height: 100% !important;
        }

        .mini-chart-header {
            background: rgba(255, 215, 0, 0.1);
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .mini-chart-title {
            margin: 0;
            color: #FFD700;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mini-chart-content {
            flex: 1;
            padding: 1rem;
            position: relative;
        }

        /* Compact Activity */
        .compact-activity {
            flex: 1;
            background: rgba(255, 255, 255, 0.03);
            border: 2px solid rgba(255, 215, 0, 0.2);
            border-radius: 15px;
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
        }

        .activity-header-compact {
            background: rgba(255, 215, 0, 0.1);
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        }

        .activity-title-compact {
            margin: 0;
            color: #FFD700;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .activity-list {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            max-height: calc(100% - 60px);
        }

        .activity-item {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 215, 0, 0.1);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
        }

        .activity-item:hover {
            background: rgba(255, 215, 0, 0.05);
            border-color: rgba(255, 215, 0, 0.3);
            transform: translateX(3px);
        }

        .activity-item:last-child {
            margin-bottom: 0;
        }

        .activity-time {
            color: #94A3B8;
            font-size: 0.85rem;
            margin-bottom: 0.25rem;
        }

        .activity-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .activity-tool {
            color: #E2E8F0;
            font-weight: 500;
        }

        .activity-site {
            color: #94A3B8;
            font-size: 0.9rem;
        }

        .activity-quantity {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            color: #0A192F;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-weight: 600;
            font-size: 0.8rem;
        }

        .activity-note {
            color: #94A3B8;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .loading-item, .empty-item, .error-item {
            text-align: center;
            color: #94A3B8;
            padding: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        /* Responsive for Single Page - 3 Column */
        @media (max-width: 1200px) {
            .single-page-grid {
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
            
            .right-column {
                grid-column: span 2;
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
            
            .compact-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 900px) {
            .single-page-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .right-column {
                grid-column: span 1;
                display: flex;
                flex-direction: column;
            }
            
            .dashboard-main {
                height: auto;
                overflow: visible;
            }
        }

        @media (max-width: 768px) {
            .compact-stats {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }
            
            .compact-nav {
                gap: 0.5rem;
            }
            
            .nav-link-compact, .refresh-btn-compact {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
            
            .mini-stat-card {
                padding: 1rem;
            }
            
            .mini-stat-icon {
                font-size: 2rem;
            }
            
            .mini-stat-number {
                font-size: 1.5rem;
            }
        }

        /* Responsive Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }

        @media (max-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-title {
                font-size: 2.5rem;
            }
            
            .stat-number {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Premium Dashboard Header -->
    <header class="dashboard-header">
        <div class="container">
            <h1 class="dashboard-title">üìä ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î</h1>
            <p class="dashboard-subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á</p>
        </div>
    </header>

    <main class="dashboard-main">
        <div class="container single-page-container">
            <!-- Compact Navigation -->
            <nav class="compact-nav">
                <a href="/" class="nav-link-compact">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
                <a href="/api-ui.html" class="nav-link-compact">üìä ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</a>
                <a href="/history.html" class="nav-link-compact">üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</a>
                <a href="/admin.html" class="nav-link-compact">‚öôÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</a>
                <button class="refresh-btn-compact" onclick="refreshDashboard()">
                    <span class="refresh-icon">üîÑ</span> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                </button>
            </nav>

            <!-- Single Page Dashboard Grid - 3 Columns -->
            <div class="single-page-grid">
                <!-- Left Column: Line Chart -->
                <div class="left-column">
                    <div class="compact-chart">
                        <div class="chart-container compact-chart-container">
                            <div class="chart-header-compact">
                                <h3 class="chart-title-compact">
                                    <span class="chart-icon">üìä</span> ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á)
                                </h3>
                            </div>
                            <div class="chart-content-compact">
                                <canvas id="dailyChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Middle Column: Stats -->
                <div class="middle-column">
                    <div class="compact-stats">
                        <div class="mini-stat-card">
                            <div class="mini-stat-icon">ÔøΩÔ∏è</div>
                            <div class="mini-stat-number" id="total-tools">-</div>
                            <div class="mini-stat-label">‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</div>
                        </div>
                        <div class="mini-stat-card">
                            <div class="mini-stat-icon">üèóÔ∏è</div>
                            <div class="mini-stat-number" id="total-sites">-</div>
                            <div class="mini-stat-label">‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô</div>
                        </div>
                        <div class="mini-stat-card">
                            <div class="mini-stat-icon">üïê</div>
                            <div class="mini-stat-number" id="recent-borrows">-</div>
                            <div class="mini-stat-label">‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                        </div>
                        <div class="mini-stat-card">
                            <div class="mini-stat-icon">ÔøΩ</div>
                            <div class="mini-stat-number" id="active-percentage">-</div>
                            <div class="mini-stat-label">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</div>
                        </div>
                    </div>

                    <!-- Compact Activity in Middle -->
                    <div class="compact-activity">
                        <div class="activity-header-compact">
                            <h4 class="activity-title-compact">
                                <span class="activity-icon">üìã</span> ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                            </h4>
                        </div>
                        <div class="activity-list" id="recent-activity">
                            <div class="activity-item loading-item">
                                <span class="loading-spinner">‚è≥</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Doughnut Chart -->
                <div class="right-column">
                    <div class="mini-chart-container full-height-chart">
                        <div class="mini-chart-header">
                            <h4 class="mini-chart-title">
                                <span class="chart-icon">üèÜ</span> ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
                            </h4>
                        </div>
                        <div class="mini-chart-content">
                            <canvas id="topToolsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
                    <div class="stat-content">
                        <div class="stat-icon">üèóÔ∏è</div>
                        <div class="stat-number" id="total-sites">-</div>
                        <div class="stat-label">‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        <div class="stat-progress">
                            <div class="progress-bar" style="width: 85%"></div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-card premium-stat-card">
                    <div class="stat-content">
                        <div class="stat-icon">üïê</div>
                        <div class="stat-number" id="recent-borrows">-</div>
                        <div class="stat-label">‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</div>
                        <div class="stat-progress">
                            <div class="progress-bar" style="width: 65%"></div>
                        </div>
                    </div>
                </div>
                <div class="dashboard-card premium-stat-card">
                    <div class="stat-content">
                        <div class="stat-icon">üìà</div>
                        <div class="stat-number" id="active-percentage">-</div>
                        <div class="stat-label">‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</div>
                        <div class="stat-progress">
                            <div class="progress-bar" style="width: 90%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Charts Grid -->
            <div class="charts-grid">
                <div class="chart-container premium-chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">
                            <span class="chart-icon">üìä</span> 
                            ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                        </h3>
                        <div class="chart-subtitle">7 ‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</div>
                    </div>
                    <div class="chart-content">
                        <canvas id="dailyChart"></canvas>
                    </div>
                </div>
                <div class="chart-container premium-chart-container">
                    <div class="chart-header">
                        <h3 class="chart-title">
                            <span class="chart-icon">üèÜ</span> 
                            ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
                        </h3>
                        <div class="chart-subtitle">TOP 5 ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</div>
                    </div>
                    <div class="chart-content">
                        <canvas id="topToolsChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Premium Recent Activity -->
            <div class="activity-section">
                <div class="dashboard-card premium-activity-card">
                    <div class="activity-header">
                        <h3 class="activity-title">
                            <span class="activity-icon">üìã</span> 
                            ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                        </h3>
                        <button class="refresh-btn" onclick="refreshDashboard()">
                            <span class="refresh-icon">ÔøΩ</span>
                            ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
                        </button>
                    </div>
                    <div class="activity-content">
                        <div id="recent-activity" class="activity-table-wrapper">
                            <table class="premium-table">
                                <thead>
                                    <tr>
                                        <th><span class="table-icon">‚è∞</span> ‡πÄ‡∏ß‡∏•‡∏≤</th>
                                        <th><span class="table-icon">üõ†Ô∏è</span> ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</th>
                                        <th><span class="table-icon">üèóÔ∏è</span> ‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô</th>
                                        <th><span class="table-icon">üî¢</span> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th>
                                        <th><span class="table-icon">üìù</span> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
                                    </tr>
                                </thead>
                                <tbody id="activity-tbody">
                                    <tr class="loading-row">
                                        <td colspan="5">
                                            <div class="loading-content">
                                                <span class="loading-spinner">‚è≥</span>
                                                <span>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</span>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Update Info -->
    <div class="update-info">
        <div class="update-text">
            ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î: <span id="last-update">-</span>
        </div>
    </div>

    <script>
        let dailyChart, topToolsChart, siteChart;

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Dashboard
        async function loadDashboardData() {
            try {
                // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
                const statsResponse = await fetch('/api/stats');
                const stats = await statsResponse.json();

                document.getElementById('total-tools').textContent = stats.totalTools;
                document.getElementById('total-sites').textContent = stats.totalSites;
                document.getElementById('recent-borrows').textContent = stats.recentBorrows.length;

                // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏£‡∏≤‡∏ü
                const chartResponse = await fetch('/api/chart-data');
                const chartData = await chartResponse.json();

                // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå
                const change = chartData.weeklyComparison.change;
                const changeText = change > 0 ? `+${change}%` : `${change}%`;
                const changeColor = change > 0 ? 'success' : change < 0 ? 'danger' : 'secondary';
                document.getElementById('active-percentage').innerHTML =
                    `${changeText} <small class="text-${changeColor}">vs ‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß</small>`;

                // ‚úÖ ‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡∏£‡∏≤‡∏ü‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
                if (dailyChart) dailyChart.destroy();
                if (topToolsChart) topToolsChart.destroy();
                if (siteChart) siteChart.destroy();

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á - ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
                const dailyCtx = document.getElementById('dailyChart').getContext('2d');
                dailyChart = new Chart(dailyCtx, {
                    type: 'line', // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÄ‡∏õ‡πá‡∏ô line chart ‡∏î‡∏π‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤
                    data: {
                        labels: chartData.dailyBorrows.map(d => d.displayDate),
                        datasets: [{
                            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°',
                            data: chartData.dailyBorrows.map(d => d.count),
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            borderColor: 'rgba(102, 126, 234, 1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        },
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: { stepSize: 1 }
                            }
                        }
                    }
                });

                // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏ß‡∏á‡∏Å‡∏•‡∏° - ‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°
                const topToolsCtx = document.getElementById('topToolsChart').getContext('2d');
                topToolsChart = new Chart(topToolsCtx, {
                    type: 'doughnut',
                    data: {
                        labels: chartData.topTools.map(t => t._id),
                        datasets: [{
                            data: chartData.topTools.map(t => t.totalQuantity),
                            backgroundColor: [
                                '#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF'
                            ]
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });

                // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏≤‡∏ü‡πÅ‡∏ó‡πà‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô - ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤‡∏á‡∏≤‡∏ô
                if (document.getElementById('siteChart')) {
                    const siteCtx = document.getElementById('siteChart').getContext('2d');
                    siteChart = new Chart(siteCtx, {
                        type: 'bar',
                        data: {
                            labels: chartData.siteStats.map(s => s._id),
                            datasets: [{
                                label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå',
                                data: chartData.siteStats.map(s => s.totalQuantity),
                                backgroundColor: 'rgba(54, 162, 235, 0.6)',
                                borderColor: 'rgba(54, 162, 235, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            indexAxis: 'y', // ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô
                            responsive: true,
                            plugins: { legend: { display: false } }
                        }
                    });
                }

                // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î (compact version)
                const activityContainer = document.getElementById('recent-activity');
                if (stats.recentBorrows.length === 0) {
                    activityContainer.innerHTML = `
                        <div class="empty-item">
                            <span>üì≠</span> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°
                        </div>`;
                } else {
                    activityContainer.innerHTML = stats.recentBorrows.slice(0, 5).map((tool, index) => `
                        <div class="activity-item" style="animation-delay: ${index * 0.1}s">
                            <div class="activity-time">${new Date(tool.borrowedAt).toLocaleString('th-TH')}</div>
                            <div class="activity-details">
                                <div class="activity-tool">üõ†Ô∏è ${tool.name}</div>
                                <div class="activity-site">üèóÔ∏è ${tool.site}</div>
                                <div class="activity-quantity">${tool.quantity}</div>
                            </div>
                            ${tool.note ? `<div class="activity-note">üìù ${tool.note}</div>` : ''}
                        </div>
                    `).join('');
                }

                // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                document.getElementById('last-update').textContent =
                    new Date().toLocaleString('th-TH');

            } catch (error) {
                console.error('Error loading dashboard data:', error);

                // ‡πÅ‡∏™‡∏î‡∏á error message ‡πÉ‡∏ô activity container
                const activityContainer = document.getElementById('recent-activity');
                activityContainer.innerHTML = `
                    <div class="error-item">
                        <span>‚ö†Ô∏è</span> ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </div>`;

                // Update time ‡πÅ‡∏°‡πâ‡∏°‡∏µ error
                document.getElementById('last-update').textContent = 
                    new Date().toLocaleString('th-TH');
            }
        }

        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä
        function refreshDashboard() {
            const refreshBtn = document.querySelector('.refresh-btn-compact');
            const refreshIcon = refreshBtn.querySelector('.refresh-icon');
            
            refreshBtn.disabled = true;
            refreshIcon.classList.add('spinning');
            refreshBtn.innerHTML = '<span class="refresh-icon spinning">üîÑ</span> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';
            
            loadDashboardData().finally(() => {
                refreshBtn.disabled = false;
                refreshIcon.classList.remove('spinning');
                refreshBtn.innerHTML = '<span class="refresh-icon">üîÑ</span> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä';
            });
        }

        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°
        document.addEventListener('DOMContentLoaded', loadDashboardData);

        // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏∏‡∏Å 30 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
        setInterval(loadDashboardData, 30000);
    </script>
</body>
</html>